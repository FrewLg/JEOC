{% extends 'base.html.twig' %}

{% block title %}Profile
{% endblock %}
{% block container_title %}Profile
{% endblock %}
{% block header_contenttwo %}Profile
{% endblock %}


{% macro displayContent(researches) %}

	<div class="col-md-4" style='width:200px;'>
		<div class="form-group select-wizard"  >
			<label class="bmd-label-floating" >Title</label>
			{{form_widget(researches.title)}}

		</div>
	</div>


	<div class="col-md-2">
		<div class="form-group select-wizard">
			<label class="bmd-label-floating">Allotted budget</label>
			{{form_widget(researches.allotted_budget)}}

		</div>
	</div>

	<div class="col-md-1">
		<div class="form-group select-wizard">
			<label class="bmd-label-floating">Year</label>
			{{form_widget(researches.year)}}

		</div>
	</div>


	<div class="col-md-2">
		<div class="form-group select-wizard">
			{{form_widget(researches.successfully_completed )}}

		</div>
	</div>

{#  
	<div class="col-md-2">
		<div class="form-group select-wizard">
		Upload approval of your clearance<br>
			{{form_widget(researches.imageFile )}}

		</div>
	</div> #}

	<div class="col-md-1">
		<div class="form-group select-wizard">
		 
		</div>
	</div>
	<div class="col-md-1">
		<div class="form-group">

			<button type="button" class=" btn btn-danger btn-sm close  remove-collection-widget mt-4   bgc-h-danger-l2 radius-round ">
				<span aria-hidden="true">Ã—</span>

			</button>
		</div>
	</div>
{% endmacro %}

{% block body %}


	<div class="row">
		<div class="col-12">
			<div class="card">
				<div class="card-body p-0"></div>
				<!--end card-body-->
				<div class="card-body">
					<div class="dastone-profile">
						<div class="row">
							<div class="col-lg-4 align-self-center mb-3 mb-lg-0">
								<div class="dastone-profile-main">
									<div class="dastone-profile-main-pic">
										{% if app.user.userInfo and app.user.userInfo.image %}

											<img src="{{ asset('files/profile_pictures/'~app.user.userInfo.image ) }}" alt="" class="rounded-circle" style="width:110px; height:110px;">
										{% else %}
											<img src="{{ asset('/img/defaultuser.png') }}" class="rounded-circle circle-border  " alt="profile" style="width:110px; height:110px;">
										{% endif %}
										<span class="dastone-profile_main-pic-change">
											<i class="fas fa-camera"></i>
										</span>
									</div>
									<div class="dastone-profile_user-detail">
										<h5 class="dastone-user-name">{{ user}}</h5>
										<p class="mb-0 dastone-user-name-post">
											{% if user.userInfo.affiliation is defined %}

												{{ user.userInfo.affiliation }}
												{% else %}
											{% endif %}
											  {% if user.userInfo.college is defined %}

											{{ user.userInfo.college }}
											{% else %}
											{% endif %}

										</p>
									</div>
								</div>
							</div>
							<!--end col-->

							<div class="col-lg-4 ms-auto align-self-center">
								<ul class="list-unstyled personal-detail mb-0">
									<li class="">
										<i class="ti ti-mobile me-2 text-secondary font-16 align-middle"></i>
										<b>
											phone
										</b>
										:
										{{ user.userInfo.phoneNumber }}</li>
									<li class="mt-2">
										<i class="ti ti-email text-secondary font-16 align-middle me-2"></i>
										<b>
											Email
										</b>
										:
										{{ user.email }}</li>
									<li class="mt-2">
										<i class="ti ti-world text-secondary font-16 align-middle me-2"></i>
										<b>
											Department:   
										</b>
										:
										<a href="" class="font-14 text-primary">
											{% if user.userInfo.department is defined %}

												{{ user.userInfo.department }}
												{% else %}
											{% endif %}
										</a>
									</li>
								</ul>

							</div>
							<!--end col-->
							<div class="col-lg-4 align-self-center">
								<div class="row">
									<div class="col-auto text-end border-end">
										<button type="button" class="btn btn-soft-primary btn-icon-circle btn-icon-circle-sm mb-2">
											<i class="fab fa-facebook-f"></i>
										</button>
										<p class="mb-0 fw-semibold">Publications</p>
										{# <h4 class="m-0 fw-bold">25k
																																																																																	<span class="text-muted font-12 fw-normal">Proceedings</span>
																																																																																</h4> #}
									</div>
									<!--end col-->
									<div class="col-auto">
										<button type="button" class="btn btn-soft-info btn-icon-circle btn-icon-circle-sm mb-2">
											<i class="fab fa-twitter"></i>
										</button>
										{# <p class="mb-0 fw-semibold">Publications</p>
																																																																																<h4 class="m-0 fw-bold">58k
																																																																																	<span class="text-muted font-12 fw-normal">Proceedings</span>
																																																																																</h4> #}
									</div>
									<!--end col-->
								</div>
								<!--end row-->
							</div>
							<!--end col-->
						</div>
						<!--end row-->
					</div>
					<!--end f_profile-->
				</div>
				<!--end card-body-->
			</div>
			<!--end card-->
		</div>
		<!--end col-->
	</div>
	<div class="pb-4">
		<ul class="nav-border nav nav-pills mb-0" id="pills-tab" role="tablist">
			<li class="nav-item">
				<a class="nav-link " id="Profile_Project_tab" data-bs-toggle="pill" href="#Profile_Project">Projects</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" id="Profile_Post_tab" data-bs-toggle="pill" href="#Profile_Post">Coferences</a>
			</li>
			{# <li class="nav-item">
																									<a class="nav-link" id="portfolio_detail_tab" data-bs-toggle="pill" href="#Profile_Portfolio">Project Membership</a>
																								</li> #}
			<li class="nav-item">
				<a class="nav-link active" id="settings_detail_tab" data-bs-toggle="pill" href="#Profile_Settings">Edit Profile</a>
			</li>
		</ul>
	</div>
	<div class="row">
		<div class="col-12">
			<div class="tab-content" id="pills-tabContent">
				<div class="tab-pane fade " id="Profile_Project" role="tabpanel" aria-labelledby="Profile_Project_tab">
					 
						<div class="row"> <div class="col-3">
							<div class="card">
								<div class="card-body "></div>
								<!--end card-body-->
							</div>
							<!--end card-->
						</div>
						<!--end col-->
						<div class="col-3"></div>
					</div>
				</div>
				<!--end tab-pane-->
				<div class="tab-pane fade" id="Profile_Post" role="tabpanel" aria-labelledby="Profile_Post_tab">
					<div class="row">
						<div class="col-lg-9">
							<div
								class="row">

								<!--end col-->
								<div class="col-lg-6">
									<div class="card">
										<div class="card-body  report-card"></div>
										<!--end card-body-->
									</div>
									<!--end card-->
								</div>
								<!--end col-->
							</div>
							<!--end row-->


							<!--end card-->
						</div>
						<!--end col-->
						<div class="col-lg-3">
							<div class="card">
								<div
									class="card-header"><!--end row-->
								</div>
								<!--end card-header-->
							{# <div class="card-body">
 </div> #}
								<!--end card-body-->
							</div>

							{# <div class="card">
	 <!--end card-body-->
																																																								</div> #}
							<!--end card-->
						</div>
						<!--end col-->
					</div>
					<!--end row-->
				</div>
				<div class="tab-pane fade" id="Profile_Portfolio" role="tabpanel" aria-labelledby="portfolio_detail_tab">
					<div class="row">
						<div class="col-md-6">{# <div class="card">
																																																									<div class="card-body">
																																																										<div class="ribbon2 rib2-primary">
			 </div> #}
							<!--end card-->
						</div>
						<!--end col-->

						<!--end col-->
					</div>


					<!--end row-->
				</div>
				<div class="tab-pane fade active show" id="Profile_Settings" role="tabpanel" aria-labelledby="settings_detail_tab">
					<div class="row">
						<div class="col-lg-12   col-xl-12">
							<div class="card">
								<div class="card-header">
									<div class="row align-items-center">
										<div class="col">
											<h4 class="card-title">Personal Information</h4>
										</div>
										<!--end col-->
									</div>
									<!--end row-->
								</div>
								<!--end card-header-->
								<div class="card-body">


									<div class="row">
										<div class="col-sm-12">

											{{ form_start(submissionform) }}

											{{form_errors(submissionform)}}

											<div
												class="row">
												{# <div class="col-12"> #}
												<div class="col-md-1">
													<div class="form-group">

														{{ form_label(submissionform.suffix  ) }}
														{{ form_widget(submissionform.suffix  ) }}
													</div>
												</div> 


												<div class="col-md-2">
													<div class="form-s">
														<div class="label">
															Given name</div>
														{{ form_widget(submissionform.first_name  ) }}
													</div>
												</div>
												<div class="col-md-3">
													<div class="form-group">

														 Midle name
														{{ form_widget(submissionform.midle_name  ) }}
													</div>
												</div>
												<div class="col-md-3">
													<div class="form-group">
														 Sur name
														 
														{{ form_widget(submissionform.last_name  ) }}
													</div>
												</div>
</div>

												<div class="row">
												<div class="col-md-2">
													<div class="form-s">
														<div class="label">
															Gender</div>
														{{ form_widget(submissionform.gender  ) }}
													</div>
												</div>
												<div class="col-md-3">
													<div class="form-group">

														{{ form_label(submissionform.alternative_email  ) }}
														{{ form_widget(submissionform.alternative_email  ) }}
													</div>
												</div>
												<div class="col-md-3">
													<div class="form-group">
														{{ form_label(submissionform.phone_number  ) }}
														{{ form_widget(submissionform.phone_number  ) }}
													</div>
												</div>

												<div class="col-md-3">
													<div class="form-group">
														{{ form_label(submissionform.image  ) }}
														{{ form_widget(submissionform.image  ) }}
													</div>
												</div>
												<div class="col-md-3">
													<div class="form-group">
														{{ form_label(submissionform.college  ) }}
														{{ form_widget(submissionform.college  ) }}
													</div>
												</div>
												<div class="col-md-12">
													<div class="form-ggroup">
													Department <br>

													<input type="hidden" name="department"/>
														<select id="dep" name="department"   class="select2 col-sm-12  col-md-12"   required="required">
														
														</select>
													</div>
												</div>
												{# <div class="col-md-3">
													<div class="form-group">
														{{ form_label(submissionform.department  ) }}
														{{ form_widget(submissionform.department  ) }}
													</div>
												</div> #}
												<div class="col-md-2">
													<div class="form-group">
														{{ form_label(submissionform.education_level  ) }}
													<br>	{{ form_widget(submissionform.education_level  ) }}
													</div>
												</div>
												<div class="col-md-3">
													<div class="form-group">
														{{ form_label(submissionform.academic_rank  ) }}
														<br>{{ form_widget(submissionform.academic_rank  ) }}
													</div>
												</div>
											</div>
											<div class="col-12">
								<br>
						<h4>If previously granted Mega project from the institute (at list in past 4 years)</h4>
												<br>
											</div>
										 


  <script type="text/javascript">

function yesnoCheck() {
    if (document.getElementById('yesCheck').checked) {
        document.getElementById('ifYes').style.display = 'block';
    }
    else document.getElementById('ifYes').style.display = 'none';

}

</script>
Yes <input type="radio" onclick="javascript:yesnoCheck();" name="yesno" id="yesCheck"> No <input type="radio" onclick="javascript:yesnoCheck();" name="yesno" id="noCheck"><br>
    <div id="ifYes" style="display:none">
														If yes, add and insert titles below:<hr>
		<button type="button" class="btn btn-primary add-another-collection-widget btn btn-sm btn-bd-primary float-right " data-list-selector="#contact-fields-list">
															<span aria-hidden="true">+</span>
											Add research Titles
										</button><br><br><br>
<ul id="contact-fields-list" class="m-t-5" data-prototype="{{_self.displayContent(submissionform.researches.vars.prototype)|e }}" data-widget-tags="{{ '<div class="row "></div>'|e }}" data-widget-counter="{{ submissionform.researches|length }}">
															{% for coAuthor in submissionform.researches %}
																<div class="row ">
																	{{ _self.displayContent(coAuthor) }}
																</div>
															{% endfor %}
														</ul>
    </div>
        
        

 


											 
											</div></div>
											<hr>
											<button class="btn btn-primary">{{ button_label|default('Save Profile') }}</button>
											{{ form_end(submissionform) }}
 
											 
										 

										</div>
									</div>


								</div>
							</div>
					 

					</div> </div></div></div> 
		 
		{% endblock %}


		{% block script %}
			<script src="{{ asset('plugins/jquery-steps/jquery.steps.min.js')}}"></script>
			<script src="{{ asset('plugins/select2/select2.min.js')}}"></script>
			{# <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js" integrity="sha512-37T7leoNS06R80c8Ulq7cdCDU5MNQBwlYoy1TX/WUsLFC2eYNqtKlV0QjH7r8JpG/S0GUMZwebnVFLPd6SU5yg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><script src="{{ asset('assets/pages/jquery.form-wizard.init.js')}}"></script>
			#}
			<script> 
				jQuery(document).ready(function () {

$(document).on('click', '.remove-collection-widget', function (e) {
$(this).closest('.row').fadeOut().remove();


});
$(document).on('click', '.add-another-collection-widget', function (e) {
$(".select2").select2();

var list = jQuery(jQuery(this).attr('data-list-selector'));

var counter = list.data('widget-counter') || list.children().length;
var newWidget = list.attr('data-prototype');
newWidget = newWidget.replace(/__name__/g, counter);
counter++;
list.data('widget-counter', counter);
var newElem = jQuery(list.attr('data-widget-tags')).html(newWidget);
newElem.appendTo(list);
$(".select").select2("destroy").select2();

$("#user_profile_researches_0_title").select2();
$("#user_profile_researches_1_title").select2(); 
$("#user_profile_researches_2_title").select2(); 
$("#user_profile_researches_3_title").select2(); 
$("#user_profile_researches_4_title").select2(); 

});
});


var form = $("#form-horizontal");


$("#form-horizontal").steps({
headerTag: "h3",
bodyTag: "fieldset",
transitionEffect: "slideLeft",
onStepChanging: function (event, currentIndex, newIndex) { // Allways allow previous action even if the current form is not valid!
if (currentIndex > newIndex) {
return true;
}


// Needed in some cases if the user went back (clean up)
if (currentIndex < newIndex) { // To remove error styles
form.find(".body:eq(" + newIndex + ") label.error").remove();
form.find(".body:eq(" + newIndex + ") .error").removeClass("error");
}

form.validate().settings.ignore = ":disabled,:hidden";
return form.valid();
},
onStepChanged: function (event, currentIndex, priorIndex) {},
onFinishing: function (event, currentIndex) {
form.validate().settings.ignore = ":disabled";
return form.valid();
},
onFinished: function (event, currentIndex) {
$("#submission_step").val(10)
form.submit();
}
}).validate({
errorPlacement: function errorPlacement(error, element) {
element.after(error);
},
rules: {
"submission[title]": {
required: true,
minlength: 5
},
"submission[agree_to_the_terms]": {
required: true
}

},
messages: {
"submission[agree_to_the_terms]": {
required: "You need to agree with the Terms and Conditions before you continue."

}
}
});
 
 
			</script>
			 
			{# <script>
		$('.oper').click(function () {

$('.choose').prop('disabled', false);
})
	</script> #}

	<script>

		$(() => {
$('.college').trigger('change')
})
$('.college').change(function () {
//$('.choose').prop('disabled', true);

var college = $('.college').val()
// console.log(college)
var select = $('.dep')

$.ajax({
url:"{{ path('department_fetch') }}",
method: "POST",
data: {
college: college
},
dataType: "json",
success: function (data) {
$('.dep').children().remove();


select.append('<option  id="dep" name="department"    value=""  >'  +'--Select Department--'+ '</option>');

for (let [key, value] of Object.entries(data)) {


select.append('<option>' + value.name + '</option>');
$("#dep").prop("required", true)


}
}
});
})
	</script>
		{% endblock %}
