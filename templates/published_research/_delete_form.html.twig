{% extends 'base.html.twig' %}
{% block title %}Submission
{% endblock %}
{% block body_title %}Submission
{% endblock %}
{% block container_title %}New submission
{% endblock %}


{% block pagehead %}New submission
{% endblock %}
{% block breadcrumb %}
	<li class="breadcrumb-item active">New submission</li>
{% endblock %}
{% macro displayBudget(budget) %}
	{# {{form_row(vitalSignTestResult)}} #}

	<div class="col-md-2">
		<div class="form-group select-wizard">
			<label class="bmd-label-floating">Category</label>
			{{form_widget(budget.category)}}

		</div>
	</div>

	<div class="col-md-4">
		<div class="form-group select-wizard">
			<label class="bmd-label-floating">Description</label>
			{{form_widget(budget.description)}}

		</div>
	</div>

	<div class="col-md-2">
		<div class="form-group select-wizard">
			<label class="bmd-label-floating">Unit Price</label>
			{{form_widget(budget.cost)}}

		</div>
	</div>
	<div class="col-md-1">
		<div class="form-group select-wizard">
			<label class="bmd-label-floating">Quantity</label>
			{{form_widget(budget.quantity)}}

		</div>
	</div>

	<div class="col-md-1">
		<div class="form-group">

			<button type="button" class=" btn btn-danger btn-sm close  remove-collection-widget mt-4   bgc-h-danger-l2 radius-round ">
				<span aria-hidden="true">×</span>

			</button>
		</div>
	</div>

{% endmacro %}

{% macro researchTime(researchTimeTable) %}
	<div class="col-md-4">
		<div class="form-group select-wizard">
			<label class="bmd-label-floating">Task</label>
			{{form_widget(researchTimeTable.task)}}
		</div>
	</div>
	<div class="col-md-3">
		<div class="form-group select-wizard">
			<label class="bmd-label-floating">Task  starting date</label>
			{{form_widget(researchTimeTable.date_start)}}
		</div>
	</div>
	<div class="col-md-3">
		<div class="form-group select-wizard">
			<label class="bmd-label-floating">Task accomplished due date</label>
			{{form_widget(researchTimeTable.date_end)}}
		</div>
	</div>
	<div class="col-md-1">
		<div class="form-group">
			<button type="button" class=" btn btn-danger btn-sm close  remove-collection-widget mt-4   bgc-h-danger-l2 radius-round ">
				<span aria-hidden="true">×</span>
			</button>
		</div>
	</div>

{% endmacro %}

{% macro displayAttachement(attachement) %}
	<div class="col-md-1">
		<div class="form-group select-wizard">
			<label class="bmd-label-floating">Type</label>
			{{form_widget(attachement.name)}}

		</div>
	</div>
	<div class="col-md-3">
		<div class="form-group select-wizard">
			<label class="bmd-label-floating">Attachement</label>
			{{form_widget(attachement.imageFile)}}

		</div>
	</div>


	<div class="col-md-1">
		<div class="form-group">

			<button type="button" class=" btn btn-danger btn-sm close  remove-collection-widget mt-4   bgc-h-danger-l2 radius-round ">
				<span aria-hidden="true">×</span>

			</button>
		</div>
	</div>


{% endmacro %}

{% macro displayAttachement2(attachement) %}
	<div class="col-md-2">
		<div class="form-group select-wizard">
			<label class="bmd-label-floating">Type</label>
			<div>{{attachement.vars.value.name}}
			</div>

		</div>
		<div class="d-none">{{form_widget(attachement)}}</div>
	</div>

	<div class="col-md-4">
		<div class="form-group select-wizard">
			<label class="bmd-label-floating">Attachement</label>
			<a class="form-control btn btn-outline-primary" href="{{ asset('uploads/submission/' ~ attachement.vars.value.file) }}">Download</a>

		</div>
	</div>


	<div class="col-md-1">
		<div class="form-group">

			<button type="button" class=" btn btn-danger btn-sm close  remove-collection-widget mt-4   bgc-h-danger-l2 radius-round ">
				<span aria-hidden="true">×</span>

			</button>
		</div>
	</div>


{% endmacro %}


{% macro displayObjective(objective) %}
	<div class="col-md-11">
		<div class="form-group select-wizard">
			<label class="bmd-label-floating">Specific objective</label>
			{{form_widget(objective.objective)}}

		</div>
	</div>


	<div class="col-md-1">
		<div class="form-group">

			<button type="button" class=" btn btn-danger btn-sm close  remove-collection-widget mt-4   bgc-h-danger-l2 radius-round ">
				<span aria-hidden="true">×</span>

			</button>
		</div>
	</div>
{% endmacro %}

{% macro displayContent(coAuthor) %}
	{# {{form_row(vitalSignTestResult)}} #}

	<div class="col-md-1">
		<div class="form-group select-wizard">
			<label class="bmd-label-floating">Title</label>
			{{form_widget(coAuthor.title)}}

		</div>
	</div>
	 

	<div class="col-md-1">
		<div class="form-group select-wizard">
			<label class="bmd-label-floating">Allotted budget</label>
			{{form_widget(coAuthor.allotted_budget)}}

		</div>
	</div>

	<div class="col-md-1">
		<div class="form-group select-wizard">
			<label class="bmd-label-floating">Year</label>
			{{form_widget(coAuthor.year)}}

		</div>
	</div> 

	<div class="col-md-2">
		<div class="form-group select-wizard">
			<label class="bmd-label-floating">successfully completed</label>
			{{form_widget(coAuthor.successfully_completed )}}

		</div>
	</div> 

	<div class="col-md-1">
		<div class="form-group select-wizard">
			<label class="bmd-label-floating">irb clearance</label>
			{{form_widget(coAuthor.irb_clearance )}}

		</div>
	</div> 
	<div class="col-md-1">
		<div class="form-group">

			<button type="button" class=" btn btn-danger btn-sm close  remove-collection-widget mt-4   bgc-h-danger-l2 radius-round ">
				<span aria-hidden="true">×</span>

			</button>
		</div>
	</div>
{% endmacro %}
{% block body %}
<div class="row">
	<div class="col-sm-12">
		<div class="card">
			 
			<!--end card-header-->
			<div class="card-body">
				{{ form_start(submissionform,{ "attr":{"id":"form-horizontal", "class":""}}) }}
			 
					 
						<div class="row">
							<div class="col-12">
				{{ form_widget(submissionform.suffix ,{ "attr":{"id":"form-horizontal", "class":""}}) }}

								<button type="button" class="btn btn-primary add-another-collection-widget btn btn-sm btn-bd-primary float-right " data-list-selector="#contact-fields-list">
									<span aria-hidden="true">+</span>
									Add Research members
								</button>
								<ul id="contact-fields-list" class="m-t-5" data-prototype="{{_self.displayContent(submissionform.researchWorks.vars.prototype)|e }}" data-widget-tags="{{ '<div class="row "></div>'|e }}" data-widget-counter="{{ submissionform.researchWorks|length }}">
									{% for coAuthor in submissionform.researchWorks %}
										<div class="row ">
											{{ _self.displayContent(coAuthor) }}
										</div>
									{% endfor %}
								</ul>


							</div>
							<!--end row-->
						</div>
					 
					<!--end fieldset-->
    <button class="btn btn-success" >{{ button_label|default('Save titles') }}</button>
 
				{{ form_end(submissionform,{'render_rest':false}) }}
				<!--end form-->
			</div>
			<!--end card-body-->
		</div>
		<!--end card-->
	</div><!--end col--></div><!--end row-->{% endblock%}
{% block script %}
	<script src="{{ asset('plugins/jquery-steps/jquery.steps.min.js')}}"></script>
	<script src="{{ asset('plugins/select2/select2.min.js')}}"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js" integrity="sha512-37T7leoNS06R80c8Ulq7cdCDU5MNQBwlYoy1TX/WUsLFC2eYNqtKlV0QjH7r8JpG/S0GUMZwebnVFLPd6SU5yg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>{# <script src="{{ asset('assets/pages/jquery.form-wizard.init.js')}}"></script> #}<script>
		jQuery(document).ready(function () {

$(document).on('click', '.remove-collection-widget', function (e) {
$(this).closest('.row').fadeOut().remove();


});
$(document).on('click', '.add-another-collection-widget', function (e) {
var list = jQuery(jQuery(this).attr('data-list-selector'));

var counter = list.data('widget-counter') || list.children().length;
var newWidget = list.attr('data-prototype');
newWidget = newWidget.replace(/__name__/g, counter);
counter++;
list.data('widget-counter', counter);
var newElem = jQuery(list.attr('data-widget-tags')).html(newWidget);
newElem.appendTo(list);
$(".select").select2("destroy").select2();
});
});


var form = $("#form-horizontal");


$("#form-horizontal").steps({
headerTag: "h3",
bodyTag: "fieldset",
transitionEffect: "slideLeft",
onStepChanging: function (event, currentIndex, newIndex) { // Allways allow previous action even if the current form is not valid!
if (currentIndex > newIndex) {
return true;
}


// Needed in some cases if the user went back (clean up)
if (currentIndex < newIndex) { // To remove error styles
form.find(".body:eq(" + newIndex + ") label.error").remove();
form.find(".body:eq(" + newIndex + ") .error").removeClass("error");
}

form.validate().settings.ignore = ":disabled,:hidden";
return form.valid();
},
onStepChanged: function (event, currentIndex, priorIndex) {
 
},
onFinishing: function (event, currentIndex) {
form.validate().settings.ignore = ":disabled";
return form.valid();
},
onFinished: function (event, currentIndex) {
$("#submission_step").val(10)
form.submit();
}
}).validate({
errorPlacement: function errorPlacement(error, element) {
element.after(error);
},
rules: {
"submission[title]": {
required: true,
minlength: 5
},
"submission[agree_to_the_terms]": {
required: true
}

},
messages: {
"submission[agree_to_the_terms]": {
required: "You need to agree with the Terms and Conditions before you continue."

}
}
});
 $.fn.steps.setStep = function (step) {
var currentIndex = $(this).steps('getCurrentIndex');
for (var i = 0; i < Math.abs(step - currentIndex); i++) {
if (step > currentIndex) {
$(this).steps('next');
} else {
$(this).steps('previous');
}
}
}; 
var $input = $('<button class="btn btn-success" type="submit">Save</button>');

$input.appendTo($('ul[aria-label=Pagination]'));
	</script>
	<script>
		$(function () {
$(".select2").select2();

})
	</script>
{% endblock %}
